<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
<link rel="stylesheet" href="/css/header.css">
<link rel="stylesheet" href="/css/footer.css">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
<script src="https://code.jquery.com/jquery-3.7.1.min.js"
	integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
	crossorigin="anonymous"></script>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title></title>
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
	rel="stylesheet">
</head>

<body>
	 <div th:replace="~{header :: header}" class="gympage"></div>
	<!-- <div class="wrapper">
		 <H2>post : 내부</H2>
		<HR>

		<table border="1">
			<tr>
				<th>제목</th>
				<th>내용</th>
				<th>작성자</th>
				<th>태그</th>
				<th>미지</th>
				<th>좋아요</th>
				<th>조회수</th>
				<th>싫어요</th>
				<th>게시판 구분</th>
			</tr>
			<tr th:each="vo : ${data}">
				<td th:text="${vo.poName}"></td>
				<td th:text="${vo.poContent}"></td>
				<td th:text="${vo.authorName}"></td>
				<td th:text="${vo.poTag}"></td>
				<td th:text="${vo.poImg}"></td>
				<td th:text="${vo.poLike}"></td>
				<td th:text="${vo.poView}"></td>
				<td th:text="${vo.poDislike}"></td>
				<td th:text="${vo.poBoardCode}"></td>
				<td><button class="edit" th:data-poid="${vo.poId}" th:data-pname="${vo.authorName}">수정</button></td>
			<tr>
			
		</table>

		
		
		<script
			src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
	</div> -->


<div class="container">
	<div class="row justify-content-center">
		<div class="col-lg-8">

			<article class="blog-post">
				<h1 class="display-5 link-body-emphasis mb-1" th:text="${data.poName}"></h1>
				<p class="blog-post-meta">작성자: <a href="#" th:text="${data.authorName}"></a>
					<span class="ms-3">태그: <span class="badge text-bg-secondary" th:text="${data.poTag}"></span></span>
					<span class="ms-3">작성일: <span class="badge text-bg-secondary" th:text="${#temporals.format(data.poTime, 'yyyy-MM-dd')}"></span></span>
				</p>
				<hr>

				<div th:if="${data.poImg != null and data.poImg != ''}" class="text-center my-4">
				    <img th:src="@{'uploads/' + ${data.poImg}}" class="img-fluid rounded shadow-sm" alt="Post Image" style="max-height: 400px;">
				</div>

				<div class="post-content fs-5 mb-4" th:text="${data.poContent}">
				</div>
				<hr>

				<div class="d-flex justify-content-between align-items-center mt-4">
					<div class="stats text-body-secondary">
						<span class="me-3" title="조회수"><i class="bi bi-eye-fill"></i> <span th:text="${data.poView}"></span></span>
						<span class="me-3" title="좋아요"><i class="bi bi-hand-thumbs-up-fill"></i> <span th:text="${data.poLike}"></span></span>
						<span title="싫어요"><i class="bi bi-hand-thumbs-down-fill"></i> <span th:text="${data.poDislike}"></span></span>
					</div>
				<div>
				
				<button class="btn btn-primary edit" th:data-poid="${data.poId}" th:data-pname="${data.authorName}">
					<i class="bi bi-pencil-square"></i> 수정
				</button>
				
			</article>
			
			<div id="comments-section" class="mt-5">
			    <h3>댓글</h3>
			    <div id="comment-list" class="mb-3"></div>
			
			    <div class="input-group">
			        <textarea id="comment-content" class="form-control" placeholder="댓글을 입력하세요"></textarea>
			        <button id="comment-submit" class="btn btn-primary">등록</button>
			    </div>
			</div>
		</div>
	</div>
</div>
<div th:replace="~{footer :: footer}"></div>
</body>
<script th:inline="javascript">
$('.edit').on('click', function() {
	let poId = ($(this).data('poid'));
	let poName = ($(this).data('pname'));
	document.location.href = "/postEditPage.do?poId=" + poId + "&authorName=" + encodeURIComponent(poName);
	return;
});

document.addEventListener("DOMContentLoaded", () => {
    const poId = [[${data.poId}]]; // 서버에서 주입

    async function loadComments() {
        const res = await fetch(`/list?poId=${poId}`);
        const data = await res.json();
        const list = document.getElementById("comment-list");
        list.innerHTML = data.length === 0
            ? "<p class='text-muted'>첫 댓글을 남겨보세요!</p>"
            : data.map(c => `
                <div class="border p-2 rounded mb-2">
                    <strong>${c.userName}</strong>
                    <small class="text-muted">${c.cmTime}</small>
                    <p class="mb-0">${c.cmContent}</p>
                </div>
            `).join("");
    }

    loadComments();

    document.getElementById("comment-submit").addEventListener("click", async () => {
        const content = document.getElementById("comment-content").value.trim();
        if (!content) {
            alert("댓글을 입력하세요!");
            return;
        }

        const res = await fetch("/write", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ poId, cmContent: content })
        });

        const text = await res.text();
        if (text === "NOT_LOGGED_IN") {
            alert("로그인 후 댓글을 작성할 수 있습니다.");
            return;
        }

        document.getElementById("comment-content").value = "";
        loadComments();
    });
});
</script>
<style>
html, body {
	height: 100%
}
.container{
	padding:150px 100px;
}
.footer {
	height: 100px;
	position: relative;
	transform: translateY(-100%);
}
.body {
	background-color: #f8f9fa; 
}
.blog-post {
	padding: 2rem;
	background-color: #ffffff;
	border-radius: 0.5rem;
	box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
}
.blog-post-meta {
	color: #6c757d;
	margin-bottom: 1.25rem;
}
.post-content {
	white-space: pre-wrap;
	line-height: 1.75;
}
.stats span {
	font-size: 1.1rem;
}
</style>
</html>
